[GH.EXPERIAN.QUEST.IMPORT - Reads in the quarterly report and updates the Beacon and Red Flag tracking records]

[*** Rename file to EXPERIANIMPORT.TXT and transfer the data as TEXT to letterfile.***]

TARGET=ACCOUNT

DEFINE
 #INCLUDE "RD.OUTPUT.DEF"
 OUTPUTCHANNEL1=NUMBER
 OUTPUTCHANNEL2=NUMBER
 ERRORTEXT=CHARACTER
 FILENAME=CHARACTER
 FNUMBER=NUMBER
 FERROR=CHARACTER
 TMPC=CHARACTER
 TMPCHR=CHARACTER                    ARRAY(40)
 N=NUMBER                            ARRAY(40)
 T=NUMBER
 LR=NUMBER
 AACCT=CHARACTER(9)                  ARRAY(400000,5)
 ALOC=NUMBER                         ARRAY(400000)
 ADATE=DATE                          ARRAY(400000)
 V=NUMBER
 H=NUMBER
 II=NUMBER
 TDATE=DATE
 CDATE=CHARACTER
 FULLNAME=CHARACTER
 REASONCODES=CHARACTER
 TUSED=NUMBER
 A=NUMBER
 NOHIT=CHARACTER
 REDFLAGS3=CHARACTER
 REDFLAGS4=CHARACTER
 R=NUMBER
 REPORTDATE=DATE
 STOPOUTPUT=CHARACTER(1)
 DOUPDATE=CHARACTER(1)
 STOPII=0                          [SET TO 0 TO RUN ALL]
 INACCTS=CHARACTER(10)              ARRAY(500)
 IN=NUMBER
 NN=NUMBER
 FNDACCT=CHARACTER(1)
 SAVENEXT=CHARACTER
 FIRSTLINE=CHARACTER(1)
 NEWERDATE=DATE
 J=NUMBER
 ONEC=CHARACTER
 FNDONEACCT=CHARACTER(1)
 FNDSSN=CHARACTER(1)
 U=NUMBER
 RLOC=NUMBER
 RED90DAY=DATE
END

SETUP
 FIRSTLINE="Y"
 RED90DAY=DATEOFFSET(SYSTEMDATE,3,31)
 FILENAME="EXPERIANIMPORT.TXT"
 CALL SETARRAY
 OUTPUTOPEN(OUTPUTDEVREPORT,0,"Experian Import Updates","",OUTPUTCHANNEL1,ERRORTEXT)
 OUTPUTOPEN(OUTPUTDEVREPORT,0,"Experian Import Exceptions","",OUTPUTCHANNEL2,ERRORTEXT)
 H=1
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
END

SELECT
 NONE
END

PRINT TITLE="Experian Import Report"
 HEADERS
  IF H=1 THEN
   DO
    COL=1 "Account"
    COL=12 "Name in File"
    COL=71 "SSN"
    COL=81 "Old"
    COL=86 "New"
    NEWLINE
    COL=1 REPEATCHR("-",88)
    NEWLINE
   END
  ELSE IF H=2 THEN
   DO
    COL=1 "Account"
    COL=12 "SSN "
    COL=35 "Name"
    COL=75 "Reason"
    NEWLINE
    COL=1 REPEATCHR("-",132)
    NEWLINE
   END
 END
 WHILELIMIT=2147483646
 STOPOUTPUT="N"
 CALL READLETTERFILE
END

TOTAL
 H=2
 OUTPUTSWITCH(OUTPUTCHANNEL2,ERRORTEXT)
 NEWLINE
 COL=1 "TOTAL: "
 PRINT U
 NEWLINE
 H=1
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 NEWLINE
 COL=1 "Updated: "
 COL=22 II
 NEWLINE
 COL=1 "Exceptions: "
 COL=22 U
 NEWLINE
 COL=1 REPEATCHR("-",22)
 NEWLINE
 COL=1 "Total: "
 COL=22 II+U
 NEWLINE
 OUTPUTCLOSE(OUTPUTCHANNEL1,ERRORTEXT)
 OUTPUTCLOSE(OUTPUTCHANNEL2,ERRORTEXT)
END

PROCEDURE READLETTERFILE
 FILEOPEN("LETTER",FILENAME,"READ",FNUMBER,FERROR)
 IF FERROR<>" " THEN PRINT "Error in Opening "+FILENAME+" For Input - "+FERROR
 WHILELIMIT=214748364
 SAVENEXT=""
 WHILE FERROR="" AND STOPOUTPUT="N"
  DO  
   TMPC=""
   FOR T=1 TO LR
    DO
     TMPCHR(T)=""
    END
   FOR T=1 TO LR
    DO
     TMPCHR(T)=""
     FOR J=1 TO N(T)
      DO
       FILEREAD(FNUMBER,1,ONEC,FERROR)     
       IF ONEC=CTRLCHR(10) THEN T=LR
       ELSE 
        DO
         TMPCHR(T)=TMPCHR(T)+ONEC
         [PRINT "ONEC "+ONEC+" TMPCHR(T) "+TMPCHR(T)
         NEWLINE]
        END
      END
     OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
    [ PRINT T
     PRINT " TMPCHR(T) "+TMPCHR(T)
     NEWLINE]
    END
   OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
  [ print t
   print " l out data "+TMPCHR(1)+" "+TMPCHR(9)
   newline]
   CALL OUTPUTDATA
  END
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 [print t
 print " f out data "+TMPCHR(1)+" "+TMPCHR(9)
 newline]
 CALL OUTPUTDATA
END

PROCEDURE OUTPUTDATA
 FULLNAME=""
 REASONCODES=""
 REDFLAGS3=""
 REDFLAGS4=""
 NOHIT=""
 FULLNAME=SEGMENT(TMPCHR(1),1,LENGTH(TMPCHR(1)))
 IF TMPCHR(2)<>"" THEN FULLNAME=FULLNAME+" "+SEGMENT(TMPCHR(2),1,LENGTH(TMPCHR(2)))
 FULLNAME=FULLNAME+" "+SEGMENT(TMPCHR(3),1,LENGTH(TMPCHR(3)))
 IF LENGTH(TMPCHR(9))<>9 OR LENGTH(FULLNAME)>40 THEN CALL UPDATENEXTRUN
 ELSE 
  DO
   CDATE=SEGMENT(TMPCHR(19),5,6)+"/"+SEGMENT(TMPCHR(19),7,8)+"/"+SEGMENT(TMPCHR(19),1,4)
   TDATE=DATEVALUE(CDATE)
   IF REPORTDATE='--/--/--' THEN REPORTDATE=TDATE
   IF TDATE='--/--/--' THEN TDATE=REPORTDATE
   IF TMPCHR(12)="Y" AND CHARACTERSEARCH(REDFLAGS4,"30")=0 THEN REDFLAGS4=REDFLAGS4+"30," 
   IF TMPCHR(14)<>"" THEN
    DO
     R=VALUE(TMPCHR(13))
     IF TMPCHR(14)="A" AND R<>6 AND CHARACTERSEARCH(REDFLAGS4,"30")=0 THEN REDFLAGS4=REDFLAGS4+"30,"
     ELSE IF TMPCHR(14)="B" AND (R=22 OR R=99) AND CHARACTERSEARCH(REDFLAGS4,"30")=0 THEN REDFLAGS4=REDFLAGS4+"30,"
     ELSE IF TMPCHR(14)="P" AND R=1 THEN NOHIT="NO HIT"
     ELSE IF TMPCHR(14)="P" AND R=2 THEN NOHIT="CONSUMER SUPPRESSION"
     ELSE IF TMPCHR(14)="S" AND R=1 AND CHARACTERSEARCH(REDFLAGS4,"03")=0 THEN REDFLAGS4=REDFLAGS4+"03,"
     ELSE IF TMPCHR(14)="S" AND R=3 AND CHARACTERSEARCH(REDFLAGS4,"24")=0 THEN REDFLAGS4=REDFLAGS4+"24,"
    END
   IF TMPCHR(18)="S" AND CHARACTERSEARCH(REDFLAGS4,"03")=0 THEN REDFLAGS4=REDFLAGS4+"03,"
   IF REDFLAGS4<>"" THEN REDFLAGS4=SEGMENT(REDFLAGS4,1,LENGTH(REDFLAGS4)-1)
   IF TMPCHR(23)<>"" THEN
    DO
     R=VALUE(TMPCHR(23))
     IF R=6 THEN REDFLAGS3="01"
     ELSE IF R=26 OR R=27 THEN REDFLAGS3="06"
     ELSE IF R=28 OR R=30 THEN REDFLAGS3="02"
     ELSE IF R=29 THEN REDFLAGS3="03"
     ELSE IF R=31 THEN REDFLAGS3="03,06"
    END
   IF TMPCHR(27)="Y" AND CHARACTERSEARCH(REDFLAGS3,"03")=0 THEN
    DO
     IF REDFLAGS3="" THEN REDFLAGS3="03"
     ELSE REDFLAGS3=REDFLAGS3+",03"
    END
   IF TMPCHR(25)="" AND TMPCHR(26)="" AND TMPCHR(27)="" AND TMPCHR(28)="" THEN REASONCODES=""
   ELSE 
    DO
     REASONCODES=FORMAT("999",VALUE(TMPCHR(25)))
     REASONCODES=REASONCODES+","+FORMAT("999",VALUE(TMPCHR(26)))
     REASONCODES=REASONCODES+","+FORMAT("999",VALUE(TMPCHR(27)))
     REASONCODES=REASONCODES+","+FORMAT("999",VALUE(TMPCHR(28)))
     IF TMPCHR(29)="08" THEN  REASONCODES=REASONCODES+","+"Y"
    END
   FNDONEACCT="N"
   FNDACCT="N"
   FOR NN=1 TO IN
    DO
     INACCTS(NN)="" 
    END
   IN=0
   FOR ACCOUNT WITH SSN TMPCHR(9)
    DO
     FNDACCT="N"
     FOR NN=1 TO IN
      DO
       IF INACCTS(NN)=ACCOUNT:NUMBER THEN FNDACCT="Y"
      END
     IF FNDACCT="N" THEN
      DO
       IN=IN+1
       INACCTS(IN)=ACCOUNT:NUMBER
      END
     A=VALUE(ACCOUNT:NUMBER)
     IF ACCOUNT:TYPE<90 AND ACCOUNT:CLOSEDATE='--/--/--' AND FNDACCT="N" THEN
      DO
       FNDSSN="N"
       FOR EACH NAME WITH NAME:EXPIRATIONDATE='--/--/--' AND NAME:SSN=TMPCHR(9) 
        DO
         FNDSSN="Y"
        END
       IF FNDSSN="N" THEN
        DO
         FOR EACH SHARE WITH SHARE:CLOSEDATE='--/--/--'
          DO
           FOR EACH SHARE NAME WITH SHARE NAME:SSN=TMPCHR(9) AND SHARE NAME:EXPIRATIONDATE='--/--/--'
            DO
             FNDSSN="Y"
            END
          END
        END
       IF FNDSSN="N" THEN
        DO
         FOR EACH LOAN WITH LOAN:CLOSEDATE='--/--/--'
          DO
           FOR EACH LOAN NAME WITH LOAN NAME:SSN=TMPCHR(9) AND LOAN NAME:EXPIRATIONDATE='--/--/--'
            DO
             FNDSSN="Y"
            END
          END
        END
       IF FNDSSN="Y" THEN
        DO
         FNDONEACCT="Y"
         FNDACCT="Y"
         TUSED=0
         DOUPDATE="Y"
         NEWERDATE='--/--/--'
         V=VALUE(TMPCHR(24))
         [IF V=0 OR V>850 THEN V=0]
         FOR EACH TRACKING WITH TRACKING:TYPE=31
          DO
           IF ALOC(A)=0 THEN ALOC(A)=TRACKING:LOCATOR
           IF TRACKING:USERCHAR1=TMPCHR(9) THEN 
            DO
             IF TRACKING:USERDATE1<TDATE THEN TUSED=1
             ELSE NEWERDATE=TRACKING:USERDATE1
            END
           ELSE IF TRACKING:USERCHAR2=TMPCHR(9) THEN 
            DO
             IF TRACKING:USERDATE2<TDATE THEN TUSED=2
             ELSE NEWERDATE=TRACKING:USERDATE2
            END
           ELSE IF TRACKING:USERCHAR3=TMPCHR(9) THEN 
            DO
             IF TRACKING:USERDATE3<TDATE THEN TUSED=3
             ELSE NEWERDATE=TRACKING:USERDATE3
            END
           ELSE IF TRACKING:USERCHAR4=TMPCHR(9) THEN 
            DO
             IF TRACKING:USERDATE4<TDATE THEN TUSED=4
             ELSE NEWERDATE=TRACKING:USERDATE4
            END
           ELSE IF TRACKING:USERCHAR5=TMPCHR(9) THEN 
            DO
             IF TRACKING:USERDATE5<TDATE THEN TUSED=5
             ELSE NEWERDATE=TRACKING:USERDATE5
            END
           IF NEWERDATE<>'--/--/--' THEN CALL UPDATENEXTRUN
           ELSE
            DO
             IF TUSED=0 THEN
              DO
               IF AACCT(A,1)=TMPCHR(9) THEN DOUPDATE="N"
               ELSE IF AACCT(A,2)=TMPCHR(9) THEN DOUPDATE="N"
               ELSE IF AACCT(A,3)=TMPCHR(9) THEN DOUPDATE="N"
               ELSE IF AACCT(A,4)=TMPCHR(9) THEN DOUPDATE="N"
               ELSE IF AACCT(A,5)=TMPCHR(9) THEN DOUPDATE="N"
               ELSE IF TRACKING:USERCHAR1="" AND AACCT(A,1)="" THEN TUSED=1
               ELSE IF TRACKING:USERCHAR2="" AND AACCT(A,2)="" THEN TUSED=2
               ELSE IF TRACKING:USERCHAR3="" AND AACCT(A,3)="" THEN TUSED=3
               ELSE IF TRACKING:USERCHAR4="" AND AACCT(A,4)="" THEN TUSED=4
               ELSE IF TRACKING:USERCHAR5="" AND AACCT(A,5)="" THEN TUSED=5
              END
             IF TUSED>0 AND DOUPDATE="Y" THEN 
              DO
               AACCT(A,TUSED)=TMPCHR(9)
               ADATE(A)=TDATE
               IF TUSED=1 AND TRACKING:USERDATE1<TDATE THEN CALL UPDATE1
               ELSE IF TUSED=2 AND TRACKING:USERDATE2<TDATE THEN CALL UPDATE2
               ELSE IF TUSED=3 AND TRACKING:USERDATE3<TDATE THEN CALL UPDATE3
               ELSE IF TUSED=4 AND TRACKING:USERDATE4<TDATE THEN CALL UPDATE4
               ELSE IF TUSED=5 AND TRACKING:USERDATE5<TDATE THEN CALL UPDATE5
              END
            END
          END
         IF ALOC(A)=0 THEN 
          DO
           IF AACCT(A,1)=TMPCHR(9) THEN DOUPDATE="N"
           ELSE IF AACCT(A,2)=TMPCHR(9) THEN DOUPDATE="N"
           ELSE IF AACCT(A,3)=TMPCHR(9) THEN DOUPDATE="N"
           ELSE IF AACCT(A,4)=TMPCHR(9) THEN DOUPDATE="N"
           ELSE IF AACCT(A,5)=TMPCHR(9) THEN DOUPDATE="N"
           ELSE
            DO
             IF AACCT(A,1)="" THEN TUSED=1
             ELSE IF AACCT(A,2)="" THEN TUSED=2
             ELSE IF AACCT(A,3)="" THEN TUSED=3
             ELSE IF AACCT(A,4)="" THEN TUSED=4
             ELSE IF AACCT(A,5)="" THEN TUSED=5
             AACCT(A,TUSED)=""
            END
           IF TUSED>0 AND DOUPDATE="Y" THEN CALL CREATETRACKING31
          END
         ELSE IF ALOC(A)=-1 THEN 
          DO
           IF TMPCHR(9)<>"" THEN CALL UPDATENEXTRUN
          END
         IF REDFLAGS3<>"" OR REDFLAGS4<>"" THEN CALL ADDREDFLAGS
        END
      END
    END
   IF FNDONEACCT="N" THEN CALL UPDATENEXTRUN
  END
 FOR NN=1 TO IN
  DO
   INACCTS(NN)="" 
  END
 IN=0
END

PROCEDURE CREATETRACKING31
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 "0"
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 ALOC(A)=-1
 AACCT(A,TUSED)=TMPCHR(9)
 ADATE(A)=TDATE
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" CREATE TRACKING LOC BEFOREFIRST TYPE 31"
 NEWLINE
 COL=2 "SET USERCHAR"+FORMAT("9",TUSED)+" TO "
 COL=49 TMPCHR(9)
 NEWLINE 
 IF TUSED<5 THEN COL=2 "SET USERCHAR"+FORMAT("9",TUSED+5)+" TO "
 ELSE COL=2 "SET USERCHAR"+FORMAT("99",TUSED+5)+" TO "
 COL=49 FULLNAME
 NEWLINE
 COL=2 "SET USERCHAR"+FORMAT("99",TUSED+10)+" TO "
 COL=49 NOHIT
 NEWLINE
 COL=2 "SET USERCHAR"+FORMAT("99",TUSED+15)+" TO "
 COL=49 REASONCODES
 NEWLINE
 COL=2 "SET USERNUMBER"+FORMAT("9",TUSED)+" TO "
 PRINT FORMAT("9999",V)
 NEWLINE
 COL=2 "SET USERNUMBER"+FORMAT("99",TUSED+10)+" TO "
 PRINT "300"
 NEWLINE
 COL=2 "SET USERNUMBER"+FORMAT("99",TUSED+15)+" TO "
 PRINT "850"
 NEWLINE
 COL=2 "SET USERDATE"+FORMAT("9",TUSED)+" TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "SET USERCODE"+FORMAT("9",TUSED)+" TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TUSED<5 THEN COL=2 "SET USERCHAR"+FORMAT("9",TUSED+5)+" TO "
 COL=2 "SET USERCODE"+FORMAT("99",TUSED+5)+" TO "
 PRINT "1"
 NEWLINE
 H=1
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
END

PROCEDURE UPDATENEXTRUN
 IF NEWERDATE<>REPORTDATE THEN
  DO
   H=2
   OUTPUTSWITCH(OUTPUTCHANNEL2,ERRORTEXT)
   COL=1 FORMAT("9999999999",A)
   COL=12 TMPCHR(9)
   COL=35 SEGMENT(FULLNAME,1,35)
   IF FNDACCT="N" THEN COL=75 "No Open Account found"
   ELSE 
    DO
     IF NEWERDATE<>'--/--/--' THEN 
      COL=75 "Score on Tracking is Newer "+FORMAT("99/99/99",NEWERDATE)
     ELSE IF LENGTH(FULLNAME)>40 THEN COL=75 "Name too long "+SEGMENT(FULLNAME,1,60)
     ELSE COL=75 "WILL UPDATE NEXT RUN"
    END
   NEWLINE
   U=U+1
   H=1
   OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
  END
END


PROCEDURE UPDATE1
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 TRACKING:USERNUMBER1
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
 PRINT TRACKING:LOCATOR
 NEWLINE
 COL=2 "CHANGE USERCHAR6 FROM "
 COL=49 TRACKING:USERCHAR6
 COL=90  "TO "+FULLNAME
 NEWLINE
 IF TRACKING:USERCHAR11<>NOHIT THEN
  DO
   COL=2 "CHANGE USERCHAR11 FROM "
   COL=49 TRACKING:USERCHAR11
   COL=90  "TO "+NOHIT
   NEWLINE
  END
 IF TRACKING:USERCHAR16<>REASONCODES THEN
  DO
   COL=2 "CHANGE USERCHAR16 FROM  "
   COL=49 TRACKING:USERCHAR16
   COL=90  "TO "+REASONCODES
   NEWLINE
  END
 COL=2 "CHANGE USERNUMBER1 FROM "
 COL=49 FORMAT("9999",TRACKING:USERNUMBER1)
 COL=90 "TO "+FORMAT("9999",V)
 NEWLINE
 IF TRACKING:USERNUMBER11<>850 THEN
  DO
   COL=2 "CHANGE USERNUMBER11 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER11)
   COL=90 "TO 850"
   NEWLINE
  END
 IF TRACKING:USERNUMBER16<>300 THEN
  DO
   COL=2 "CHANGE USERNUMBER16 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER16)
   COL=90 "TO 300"
   NEWLINE
  END
 COL=2 "CHANGE USERDATE1 FROM "
 COL=49 FORMAT("99/99/99",TRACKING:USERDATE1)
 COL=90 "TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "CHANGE USERCODE1 FROM "
 COL=49 FORMAT("###9",TRACKING:USERCODE1)
 COL=90 "TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TRACKING:USERCODE6<>1 THEN
  DO
   COL=2 "CHANGE USERCODE6 FROM "
   COL=49 FORMAT("9",TRACKING:USERCODE6)
   COL=90 "TO 1"
   NEWLINE
  END
END

PROCEDURE UPDATE2
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 TRACKING:USERNUMBER2
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
 PRINT TRACKING:LOCATOR
 NEWLINE
 COL=2 "CHANGE USERCHAR7 FROM "
 COL=49 TRACKING:USERCHAR7
 COL=90  "TO "+FULLNAME
 NEWLINE
 IF TRACKING:USERCHAR12<>NOHIT THEN
  DO
   COL=2 "CHANGE USERCHAR12 FROM "
   COL=49 TRACKING:USERCHAR12
   COL=90  "TO "+NOHIT
   NEWLINE
  END
 IF TRACKING:USERCHAR17<>REASONCODES THEN
  DO
   COL=2 "CHANGE USERCHAR17 FROM  "
   COL=49 TRACKING:USERCHAR17
   COL=90  "TO "+REASONCODES
   NEWLINE
  END
 COL=2 "CHANGE USERNUMBER2 FROM "
 COL=49 FORMAT("9999",TRACKING:USERNUMBER2)
 COL=90 "TO "+FORMAT("9999",V)
 NEWLINE
 IF TRACKING:USERNUMBER12<>850 THEN
  DO
   COL=2 "CHANGE USERNUMBER12 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER12)
   COL=90 "TO 850"
   NEWLINE
  END
 IF TRACKING:USERNUMBER17<>300 THEN
  DO
   COL=2 "CHANGE USERNUMBER17 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER17)
   COL=90 "TO 300"
   NEWLINE
  END
 COL=2 "CHANGE USERDATE2 FROM "
 COL=49 FORMAT("99/99/99",TRACKING:USERDATE2)
 COL=90 "TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "CHANGE USERCODE2 FROM "
 COL=49 FORMAT("###9",TRACKING:USERCODE2)
 COL=90 "TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TRACKING:USERCODE7<>1 THEN
  DO
   COL=2 "CHANGE USERCODE7 FROM "
   COL=49 FORMAT("9",TRACKING:USERCODE7)
   COL=90 "TO 1"
   NEWLINE
  END
END

PROCEDURE UPDATE3
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 TRACKING:USERNUMBER3
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
 PRINT TRACKING:LOCATOR
 NEWLINE
 COL=2 "CHANGE USERCHAR8 FROM "
 COL=49 TRACKING:USERCHAR8
 COL=90  "TO "+FULLNAME
 NEWLINE
 IF TRACKING:USERCHAR13<>NOHIT THEN
  DO
   COL=2 "CHANGE USERCHAR13 FROM "
   COL=49 TRACKING:USERCHAR13
   COL=90  "TO "+NOHIT
   NEWLINE
  END
 IF TRACKING:USERCHAR18<>REASONCODES THEN
  DO
   COL=2 "CHANGE USERCHAR18 FROM  "
   COL=49 TRACKING:USERCHAR18
   COL=90  "TO "+REASONCODES
   NEWLINE
  END
 COL=2 "CHANGE USERNUMBER3 FROM "
 COL=49 FORMAT("9999",TRACKING:USERNUMBER3)
 COL=90 "TO "+FORMAT("9999",V)
 NEWLINE
 IF TRACKING:USERNUMBER13<>850 THEN
  DO
   COL=2 "CHANGE USERNUMBER13 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER13)
   COL=90 "TO 850"
   NEWLINE
  END
 IF TRACKING:USERNUMBER18<>300 THEN
  DO
   COL=2 "CHANGE USERNUMBER18 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER18)
   COL=90 "TO 300"
   NEWLINE
  END
 COL=2 "CHANGE USERDATE3 FROM "
 COL=49 FORMAT("99/99/99",TRACKING:USERDATE3)
 COL=90 "TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "CHANGE USERCODE3 FROM "
 COL=49 FORMAT("###9",TRACKING:USERCODE3)
 COL=90 "TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TRACKING:USERCODE8<>1 THEN
  DO
   COL=2 "CHANGE USERCODE8 FROM "
   COL=49 FORMAT("9",TRACKING:USERCODE8)
   COL=90 "TO 1"
   NEWLINE
  END
END

PROCEDURE UPDATE4
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 TRACKING:USERNUMBER4
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
 PRINT TRACKING:LOCATOR
 NEWLINE
 COL=2 "CHANGE USERCHAR9 FROM "
 COL=49 TRACKING:USERCHAR9
 COL=90  "TO "+FULLNAME
 NEWLINE
 IF TRACKING:USERCHAR14<>NOHIT THEN
  DO
   COL=2 "CHANGE USERCHAR14 FROM "
   COL=49 TRACKING:USERCHAR14
   COL=90  "TO "+NOHIT
   NEWLINE
  END
 IF TRACKING:USERCHAR19<>REASONCODES THEN
  DO
   COL=2 "CHANGE USERCHAR19 FROM  "
   COL=49 TRACKING:USERCHAR19
   COL=90  "TO "+REASONCODES
   NEWLINE
  END
 COL=2 "CHANGE USERNUMBER4 FROM "
 COL=49 FORMAT("9999",TRACKING:USERNUMBER4)
 COL=90 "TO "+FORMAT("9999",V)
 NEWLINE
 IF TRACKING:USERNUMBER14<>850 THEN
  DO
   COL=2 "CHANGE USERNUMBER14 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER14)
   COL=90 "TO 850"
   NEWLINE
  END
 IF TRACKING:USERNUMBER19<>300 THEN
  DO
   COL=2 "CHANGE USERNUMBER19 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER19)
   COL=90 "TO 300"
   NEWLINE
  END
 COL=2 "CHANGE USERDATE4 FROM "
 COL=49 FORMAT("99/99/99",TRACKING:USERDATE4)
 COL=90 "TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "CHANGE USERCODE4 FROM "
 COL=49 FORMAT("###9",TRACKING:USERCODE4)
 COL=90 "TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TRACKING:USERCODE9<>1 THEN
  DO
   COL=2 "CHANGE USERCODE9 FROM "
   COL=49 FORMAT("9",TRACKING:USERCODE9)
   COL=90 "TO 1"
   NEWLINE
  END
END

PROCEDURE UPDATE5
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
 COL=1 ACCOUNT:NUMBER
 COL=12 FULLNAME
 COL=71 TMPCHR(9)
 COL=83 TRACKING:USERNUMBER5
 COL=86 FORMAT("9999",V)
 IF VALUE(TMPCHR(24))>850 THEN PRINT " - "+TMPCHR(24)
 NEWLINE
 II=II+1
 IF STOPII>0 AND II>STOPII THEN STOPOUTPUT="Y"
 H=3
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
 PRINT TRACKING:LOCATOR
 NEWLINE
 COL=2 "CHANGE USERCHAR10 FROM "
 COL=49 TRACKING:USERCHAR10
 COL=90  "TO "+FULLNAME
 NEWLINE
 IF TRACKING:USERCHAR15<>NOHIT THEN
  DO
   COL=2 "CHANGE USERCHAR15 FROM "
   COL=49 TRACKING:USERCHAR15
   COL=90  "TO "+NOHIT
   NEWLINE
  END
 IF TRACKING:USERCHAR20<>REASONCODES THEN
  DO
   COL=2 "CHANGE USERCHAR20 FROM  "
   COL=49 TRACKING:USERCHAR20
   COL=90  "TO "+REASONCODES
   NEWLINE
  END
 COL=2 "CHANGE USERNUMBER5 FROM "
 COL=49 FORMAT("9999",TRACKING:USERNUMBER5)
 COL=90 "TO "+FORMAT("9999",V)
 NEWLINE
 IF TRACKING:USERNUMBER15<>850 THEN
  DO
   COL=2 "CHANGE USERNUMBER15 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER15)
   COL=90 "TO 850"
   NEWLINE
  END
 IF TRACKING:USERNUMBER19<>300 THEN
  DO
   COL=2 "CHANGE USERNUMBER20 FROM "
   COL=49 FORMAT("999",TRACKING:USERNUMBER20)
   COL=90 "TO 300"
   NEWLINE
  END
 COL=2 "CHANGE USERDATE5 FROM "
 COL=49 FORMAT("99/99/99",TRACKING:USERDATE5)
 COL=90 "TO "+FORMAT("99/99/99",TDATE)
 NEWLINE
 COL=2 "CHANGE USERCODE5 FROM "
 COL=49 FORMAT("###9",TRACKING:USERCODE5)
 COL=90 "TO "+FORMAT("###9",SYSACTUALTIME)
 NEWLINE
 IF TRACKING:USERCODE1<>10 THEN
  DO
   COL=2 "CHANGE USERCODE10 FROM "
   COL=49 FORMAT("9",TRACKING:USERCODE10)
   COL=90 "TO 1"
   NEWLINE
  END
END

PROCEDURE ADDREDFLAGS
 RLOC=0
 OUTPUTSWITCH(OUTPUTCHANNEL1,ERRORTEXT)
 FOR EACH TRACKING WITH TRACKING:TYPE=12 AND TRACKING:USERCHAR1=TMPCHR(9)
  DO
   IF RLOC=0 THEN
    DO
     RLOC=TRACKING:LOCATOR
     IF TRACKING:EXPIREDATE='--/--/--' OR TRACKING:EXPIREDATE<RED90DAY THEN
      DO
       COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" MODIFY TRACKING LOC "
       PRINT TRACKING:LOCATOR
       NEWLINE
       COL=2 "CHANGE USERCHAR3 FROM "
       COL=49 TRACKING:USERCHAR3
       COL=90  "TO "+REDFLAGS3
       NEWLINE
       COL=2 "CHANGE USERCHAR4 FROM "
       COL=49 TRACKING:USERCHAR4
       COL=90  "TO "+REDFLAGS4
       NEWLINE
       COL=2 "CHANGE USERDATE1 FROM "
       COL=49 FORMAT("99/99/9999",TRACKING:USERDATE1)
       COL=90  "TO --/--/--"
       NEWLINE
       COL=2 "CHANGE EXPIREDATE FROM "
       COL=49 FORMAT("99/99/9999",TRACKING:EXPIREDATE)
       COL=90  "TO "+FORMAT("99/99/99",RED90DAY)
       NEWLINE
      END
    END
  END
 IF RLOC=0 THEN
  DO
   COL=1 "ACCOUNT "+ACCOUNT:NUMBER+" CREATE TRACKING LOC BEFOREFIRST TYPE 12"
   NEWLINE
   COL=2 "SET USERCHAR1 TO "
   COL=49 TMPCHR(9)
   NEWLINE
   COL=2 "SET USERCHAR3 TO "
   COL=49 REDFLAGS3
   NEWLINE
   COL=2 "SET USERCHAR4 TO "
   COL=49 REDFLAGS4
   NEWLINE
   COL=2 "SET USERDATE1 TO "
   COL=49  "--/--/--"
   NEWLINE
   COL=2 "SET EXPIREDATE TO "
   COL=49 FORMAT("99/99/99",RED90DAY)
   NEWLINE
  END
 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,ERRORTEXT)
END

PROCEDURE SETARRAY
 N(1)=32     [First name           01]          
 N(2)=32     [Middle name          32]               
 N(3)=32     [Last name            64]  
 N(4)=32     [Street               96]              
 N(5)=32     [Extra Address       128]       
 N(6)=23     [City                160]                 
 N(7)=2      [State               183] 
 N(8)=5      [Zip                 185]               
 N(9)=9      [SSN                 190]         
 N(10)=8     [DOB YYYMMDD         199]            
 N(11)=53    [Filler-23 Control-3 Sequence-10 PIN-17 207] 
 N(12)=1     [Address Match       260]    
 N(13)=2     [Val Error Code      261]     
 N(14)=1     [Val Cat Code        263] 
 N(15)=1     [Dup PIN             264]      
 N(16)=1     [Security Alert      265]      
 N(17)=1     [Consumer Sttement   266] 
 N(18)=1     [Deceased Flag       267]    
 N(19)=8     [Score Date YYYYMMDD 268]
 N(20)=10    [XYF01-XYF07         276]      
 N(21)=1     [Not Used Old MLA    286]
 N(22)=64    [Security Alert Date 1-2 Phone1-3 287] 
 N(23)=2     [Security Alert Type 351]  
 N(24)=4     [SCORE               353]          
 N(25)=2     [REASON CODE 1       357]    
 N(26)=2     [REASON CODE 2       359]    
 N(27)=2     [REASON CODE 3       361]      
 N(28)=2     [REASON CODE 4       363]     
 N(29)=2     [REASON CODE 5       365]     
 N(30)=1     [CR/LF]
 LR=30
END

[This is the layout with MLA
 N(21)=1     [MLA                 286]     
 N(22)=65    [Security Alert Date 1-2 Phone1-3 287] 
 N(23)=2     [Security Alert Type 352]  
 N(24)=4     [SCORE               354]          
 N(25)=2     [REASON CODE 1       358]    
 N(26)=2     [REASON CODE 2       360]    
 N(27)=2     [REASON CODE 3       362]      
 N(28)=2     [REASON CODE 4       364]     
 N(29)=2     [REASON CODE 5       366]     
 N(30)=1     [CR/LF]
 LR=30
]
